# falco/custom_rules.yaml

- rule: Detect Shell in Container
  desc: Detect when a shell is spawned inside a container
  condition: spawned_process and container and proc.name in (bash, sh, zsh)
  output: "Shell spawned in container (user=%user.name command=%proc.cmdline)"
  priority: WARNING
  tags: [container, shell]

- rule: Write below etc directory
  desc: Detect writing below /etc directory (could indicate tampering)
  condition: evt.type = write and fd.name startswith /etc
  output: "Write below /etc detected (user=%user.name file=%fd.name)"
  priority: WARNING
  tags: [filesystem, security]

- rule: Unexpected Network Connection
  desc: Detect network connections from containers to external IPs (example)
  condition: evt.type = connect and container and not fd.sip in (127.0.0.1, 10.0.0.0/8, 192.168.0.0/16)
  output: "Container network connection to external IP (user=%user.name src=%fd.sip dst=%fd.dip)"
  priority: NOTICE
  tags: [network, container]

- rule: Exec Sensitive Binary
  desc: Detect execution of sensitive binaries like /bin/su or /bin/passwd
  condition: spawned_process and proc.name in (su, passwd)
  output: "Sensitive binary executed (user=%user.name proc=%proc.name cmdline=%proc.cmdline)"
  priority: WARNING
  tags: [process, sensitive]
